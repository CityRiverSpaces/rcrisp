<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>2. Getting OSM data for delineation • rcrisp</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="2. Getting OSM data for delineation">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">rcrisp</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.2</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/method.html">The method</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Preparation</h6></li>
    <li><a class="dropdown-item" href="../articles/getting-osm-data.html">Getting OSM data for delineation</a></li>
    <li><a class="dropdown-item" href="../articles/network-preparation.html">Preparing the network for delineation</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Delineation</h6></li>
    <li><a class="dropdown-item" href="../articles/valley-delineation.html">Valley delineation</a></li>
    <li><a class="dropdown-item" href="../articles/corridor-delineation.html">Corridor delineation</a></li>
    <li><a class="dropdown-item" href="../articles/corridor-segmentation.html">Corridor segmentation</a></li>
    <li><a class="dropdown-item" href="../articles/riverspace-delineation.html">Riverspace delineation</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/CityRiverSpaces/rcrisp/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>2. Getting OSM data for delineation</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/CityRiverSpaces/rcrisp/blob/main/vignettes/getting-osm-data.Rmd" class="external-link"><code>vignettes/getting-osm-data.Rmd</code></a></small>
      <div class="d-none name"><code>getting-osm-data.Rmd</code></div>
    </div>

    
    
<p>In this notebook we download OSM data needed for the delineation of
the urban river corridor of River Dâmbovița in Bucharest, Romania. We
make sure that we include a given area around the city boundaries.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">city_name</span> <span class="op">&lt;-</span> <span class="st">"Bucharest"</span></span>
<span><span class="va">river_name</span> <span class="op">&lt;-</span> <span class="st">"Dâmbovița"</span></span>
<span><span class="va">crs</span> <span class="op">&lt;-</span> <span class="fl">32635</span>  <span class="co"># EPSG code for UTM zone 35N</span></span>
<span><span class="va">bbox_buffer</span> <span class="op">&lt;-</span> <span class="fl">2000</span>  <span class="co"># in m, expand bbox for street network</span></span></code></pre></div>
<p>We start by getting the bounding box for the study area:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bb</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_osm_bb.html">get_osm_bb</a></span><span class="op">(</span><span class="va">city_name</span><span class="op">)</span></span></code></pre></div>
<p>Using the obtained bounding box, we get the different layers of OSM
data needed for the delineation of the urban river corridor. We will get
the city boundary, the waterways, the street network, and the rail
network using built-in functions from the <code>rcrisp</code>
package.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">city_boundary</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_osm_city_boundary.html">get_osm_city_boundary</a></span><span class="op">(</span><span class="va">city_name</span>, <span class="va">bb</span>, <span class="va">crs</span><span class="op">)</span></span>
<span><span class="va">river</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_osm_river.html">get_osm_river</a></span><span class="op">(</span><span class="va">river_name</span>, <span class="va">bb</span>, <span class="va">crs</span><span class="op">)</span></span>
<span><span class="va">streets</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_osm_streets.html">get_osm_streets</a></span><span class="op">(</span><span class="va">bb</span>, <span class="va">crs</span><span class="op">)</span></span>
<span><span class="va">railways</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_osm_railways.html">get_osm_railways</a></span><span class="op">(</span><span class="va">bb</span>, <span class="va">crs</span><span class="op">)</span></span></code></pre></div>
<p>Individual layers can be written to disk before being read in for
delineation.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bucharest_osm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  bb <span class="op">=</span> <span class="va">bb</span>,</span>
<span>  boundary <span class="op">=</span> <span class="va">city_boundary</span>,</span>
<span>  river_centerline <span class="op">=</span> <span class="va">river</span><span class="op">$</span><span class="va">centerline</span>,</span>
<span>  river_surface <span class="op">=</span> <span class="va">river</span><span class="op">$</span><span class="va">surface</span>,</span>
<span>  streets <span class="op">=</span> <span class="va">streets</span>,</span>
<span>  railways <span class="op">=</span> <span class="va">railways</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">walk2</span><span class="op">(</span></span>
<span>  <span class="va">bucharest_osm</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">bucharest_osm</span><span class="op">)</span>,</span>
<span>  <span class="op">~</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_write.html" class="external-link">st_write</a></span><span class="op">(</span></span>
<span>    <span class="va">.x</span>,</span>
<span>    dsn <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"%s_%s.gpkg"</span>, <span class="va">.y</span>, <span class="va">city_name</span><span class="op">)</span>,</span>
<span>    append <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>    quiet <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>The above layers can also be obtained with the all-in-one function
<code><a href="../reference/get_osmdata.html">get_osmdata()</a></code>. Optionally, a bounding box buffer can be
specified to expand the bounding box.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bucharest_osm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_osmdata.html">get_osmdata</a></span><span class="op">(</span><span class="va">city_name</span>, <span class="va">river_name</span>, buffer <span class="op">=</span> <span class="va">bbox_buffer</span><span class="op">)</span></span></code></pre></div>
<p>The resulting object is a list with all the layers obtained
individually above.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">bucharest_osm</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/ns-load.html" class="external-link">requireNamespace</a></span><span class="op">(</span><span class="st">"ggplot2"</span>, quietly <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">bucharest_osm</span><span class="op">$</span><span class="va">boundary</span>, fill <span class="op">=</span> <span class="st">"grey"</span>, color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">bucharest_osm</span><span class="op">$</span><span class="va">railways</span>, color <span class="op">=</span> <span class="st">"orange"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">bucharest_osm</span><span class="op">$</span><span class="va">streets</span>, color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">bucharest_osm</span><span class="op">$</span><span class="va">river_surface</span>, fill <span class="op">=</span> <span class="st">"blue"</span>, color <span class="op">=</span> <span class="st">"blue"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">bucharest_osm</span><span class="op">$</span><span class="va">river_centerline</span>, color <span class="op">=</span> <span class="st">"blue"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html" class="external-link">xlim</a></span><span class="op">(</span><span class="fl">417000</span>, <span class="fl">439000</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html" class="external-link">ylim</a></span><span class="op">(</span><span class="fl">4908800</span>, <span class="fl">4932500</span><span class="op">)</span></span>
<span><span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="st">"ggplot2 not available; skipping plot examples."</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<div class="figure">
<img src="getting-osm-data_files/figure-html/unnamed-chunk-8-1.png" alt="All layers combined" width="700"><p class="caption">
All layers combined
</p>
</div>
  </main>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Claudiu Forgaci, Francesco Nattino, Netherlands eScience Center.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
